(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[138],{3355:function(e,t,a){Promise.resolve().then(a.bind(a,8978)),Promise.resolve().then(a.bind(a,9608))},8978:function(e,t,a){"use strict";a.d(t,{default:function(){return l}});var n=a(7437),o=a(2265),r=a(9501),s=a(5674);function l(){let[e,t]=(0,o.useState)(!1),[a,l]=(0,o.useState)(1),[i,c]=(0,o.useState)(""),[d,m]=(0,o.useState)(""),{register:p,handleSubmit:u,formState:{errors:h}}=(0,r.cI)(),x=e=>{c(e),m(e),localStorage.setItem("donationAmount",e),window.dispatchEvent(new StorageEvent("storage",{key:"donation-amount-change",newValue:e}))},g=async e=>{t(!0);try{l(2),localStorage.setItem("donationAmount",i),localStorage.setItem("donorName",e.name),localStorage.setItem("donorPhone",e.phone),localStorage.setItem("donorEmail",e.email),window.dispatchEvent(new StorageEvent("storage",{key:"donation-amount-change",newValue:i}))}catch(e){console.error("Error submitting donation:",e)}finally{t(!1)}};return(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-6",children:1===a?(0,n.jsxs)("form",{onSubmit:u(g),children:[(0,n.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"name",className:"form-label",children:"Your Name"}),(0,n.jsx)("input",{id:"name",type:"text",className:"form-input",placeholder:"Enter your full name",...p("name",{required:"Name is required"})}),h.name&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.name.message})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"phone",className:"form-label",children:"Phone Number"}),(0,n.jsx)("input",{id:"phone",type:"tel",className:"form-input",placeholder:"Enter your phone number",...p("phone",{required:"Phone number is required",pattern:{value:/^\d{10}$/,message:"Please enter a valid 10-digit phone number"}})}),h.phone&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.phone.message})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email Address (Optional)"}),(0,n.jsx)("input",{id:"email",type:"email",className:"form-input",placeholder:"Enter your email address",...p("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Please enter a valid email address"}})}),h.email&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-1",children:h.email.message})]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{className:"form-label",children:"Donation Amount (₹)"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[500,1e3,2e3,5e3].map(e=>(0,n.jsxs)("button",{type:"button",className:"py-3 px-4 rounded-md border transition-colors ".concat(i===e?"bg-primary text-white border-primary":"border-gray-300 hover:border-primary hover:bg-primary-light hover:bg-opacity-10"),onClick:()=>x(e),children:["₹",e.toLocaleString()]},e))}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:"number",placeholder:"Or enter a custom amount",className:"form-input pl-8",value:d,onChange:e=>{let t=e.target.value;m(t),t&&x(parseFloat(t))},min:"100"}),(0,n.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"₹"})]}),!i&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-1",children:"Please select or enter a donation amount"})]}),(0,n.jsxs)("button",{type:"submit",className:"btn-primary w-full flex items-center justify-center gap-2 ".concat(!i||e?"opacity-70 cursor-not-allowed":""),disabled:!i||e,children:[(0,n.jsx)(s.$0H,{})," Continue to Payment"]})]}):(0,n.jsxs)("div",{className:"text-center mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Donation Information"}),(0,n.jsxs)("p",{className:"text-gray-600",children:["Amount: ",(0,n.jsxs)("span",{className:"font-medium",children:["₹",parseFloat(i).toLocaleString()]})]}),(0,n.jsx)("button",{onClick:()=>l(1),className:"text-primary text-sm font-medium mt-2 hover:underline",children:"Edit Details"}),(0,n.jsx)("div",{className:"mt-6 mb-2 border-t pt-4",children:(0,n.jsx)("p",{className:"text-gray-600 text-sm",children:"Please select a payment option on the right to complete your donation."})})]})})}},9608:function(e,t,a){"use strict";a.d(t,{default:function(){return i}});var n=a(7437),o=a(2265),r=a(3145),s=a(5819),l=a(5674);function i(e){let{upiOptions:t,ngoSettings:a}=e,[i,c]=(0,o.useState)(0),[d,m]=(0,o.useState)(null),[p,u]=(0,o.useState)(""),[h,x]=(0,o.useState)(""),g=(0,o.useRef)(null);(0,o.useEffect)(()=>{x("DON".concat(Date.now().toString().substr(-8)))},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("donationAmount");e&&c(parseFloat(e));let t=e=>{"donation-amount-change"===e.key&&c(parseFloat(e.newValue))};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[]),(0,o.useEffect)(()=>{d&&i>0&&y(d)},[d,i]);let y=async e=>{if(e&&i)try{let t=await fetch("/api/qrcode?upiId=".concat(encodeURIComponent(e.upi_id),"&amount=").concat(i,"&referenceId=").concat(h));if(!t.ok)throw Error("Failed to generate QR code");let a=await t.json();u(a.qrCode)}catch(t){console.error("Error generating QR code from API, falling back to client-side generation:",t);try{let t=(null==a?void 0:a.name)||"Animal Welfare NGO",n="upi://pay?pa=".concat(e.upi_id,"&pn=").concat(encodeURIComponent(t),"&am=").concat(i,"&cu=INR&tn=").concat(h),o=await s.toDataURL(n,{width:300,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});u(o)}catch(e){console.error("Error in fallback QR code generation:",e)}}},f=e=>{m(e)},b=async()=>{if(p&&navigator.share)try{let e=await fetch(p),t=await e.blob(),n=new File([t],"qrcode.png",{type:"image/png"});await navigator.share({title:"Donation to ".concat((null==a?void 0:a.name)||"Animal Welfare NGO"),text:"Scan this QR code to donate ₹".concat(i," via ").concat((null==d?void 0:d.app_name)||"UPI"),files:[n]})}catch(e){console.error("Error sharing QR code:",e)}};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:t.map(e=>(0,n.jsx)("button",{className:"flex items-center justify-center p-4 border rounded-lg transition-all ".concat((null==d?void 0:d._id)===e._id?"border-primary-dark bg-primary-light bg-opacity-20":"border-gray-200 hover:border-primary hover:bg-gray-50"),onClick:()=>f(e),style:{borderColor:(null==d?void 0:d._id)===e._id?e.app_color:"",backgroundColor:(null==d?void 0:d._id)===e._id?"".concat(e.app_color,"15"):""},children:(0,n.jsxs)("div",{className:"text-center",children:[e.app_logo?(0,n.jsx)("div",{className:"flex justify-center mb-2",children:(0,n.jsx)(r.default,{src:e.app_logo,alt:e.app_name,width:40,height:40,className:"rounded-full"})}):null,(0,n.jsx)("div",{className:"font-medium",children:e.display_name||e.app_name})]})},e._id))}),d&&p?(0,n.jsxs)("div",{className:"border rounded-lg p-6 bg-white",ref:g,children:[(0,n.jsxs)("div",{className:"text-center mb-4",children:[(0,n.jsxs)("h3",{className:"font-medium text-lg",children:["Scan with ",d.display_name||d.app_name]}),(0,n.jsxs)("p",{className:"text-gray-600 text-sm",children:["Amount: ₹",i," • Ref: ",h]})]}),(0,n.jsx)("div",{className:"flex justify-center mb-4",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("img",{src:p,alt:"".concat(d.app_name," Payment QR Code"),className:"max-w-full h-auto",style:{maxWidth:"250px"}}),(null==a?void 0:a.logo)&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-30",style:{pointerEvents:"none"},children:(0,n.jsx)(r.default,{src:a.logo,alt:a.name||"NGO Logo",width:60,height:60,className:"opacity-60"})})]})}),(0,n.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,n.jsxs)("button",{onClick:()=>{if(!p)return;let e=document.createElement("a"),t=d?d.app_name:"UPI";e.download="".concat(t,"-Payment-").concat(i,"-").concat(h,".png"),e.href=p,document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"flex items-center gap-2 px-3 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors",title:"Download QR Code",children:[(0,n.jsx)(l.aBF,{})," Download"]}),"undefined"!=typeof navigator&&navigator.share&&(0,n.jsxs)("button",{onClick:b,className:"flex items-center gap-2 px-3 py-2 bg-secondary text-white rounded-md hover:opacity-90 transition-colors",title:"Share QR Code",children:[(0,n.jsx)(l.PPi,{})," Share"]}),(0,n.jsxs)("button",{onClick:()=>{if(!p)return;let e=window.open("","_blank"),t=(null==a?void 0:a.name)||"Animal Welfare NGO";e.document.write("\n      <html>\n        <head>\n          <title>Payment QR Code - ".concat(t,"</title>\n          <style>\n            body {\n              font-family: Arial, sans-serif;\n              text-align: center;\n              padding: 20px;\n              max-width: 600px;\n              margin: 0 auto;\n            }\n            .qr-container {\n              margin: 20px 0;\n            }\n            .logo {\n              max-width: 120px;\n              margin-bottom: 10px;\n            }\n            .instructions {\n              font-size: 14px;\n              color: #555;\n              margin-top: 20px;\n              text-align: left;\n            }\n            .details {\n              margin: 15px 0;\n              font-size: 16px;\n            }\n          </style>\n        </head>\n        <body>\n          ").concat((null==a?void 0:a.logo)?'<img src="'.concat(a.logo,'" alt="').concat(t,' Logo" class="logo" />'):"","\n          <h2>").concat(t,'</h2>\n          <div class="details">\n            Amount: ₹').concat(i.toFixed(2),"<br>\n            Reference: ").concat(h,'\n          </div>\n          <div class="qr-container">\n            <img src="').concat(p,'" alt="Payment QR Code" style="max-width: 300px;" />\n          </div>\n          <div class="instructions">\n            <h3>How to use this QR code:</h3>\n            <ol>\n              <li>Open any UPI payment app on your smartphone</li>\n              <li>Select the \'Scan QR\' option</li>\n              <li>Scan this QR code with your phone camera</li>\n              <li>Verify the payment details and complete the transaction</li>\n              <li>Save the transaction receipt for your records</li>\n            </ol>\n          </div>\n        </body>\n      </html>\n    ')),e.document.close(),e.focus(),setTimeout(()=>{e.print()},500)},className:"flex items-center gap-2 px-3 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",title:"Print QR Code",children:[(0,n.jsx)(l.rcQ,{})," Print"]})]})]}):(0,n.jsx)("div",{className:"border rounded-lg p-6 bg-gray-50 text-center",children:(0,n.jsx)("p",{children:i>0?"Select a payment option above to generate a QR code":"Please enter a donation amount first"})}),d&&(0,n.jsxs)("div",{className:"mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"Manual Payment Instructions"}),(0,n.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:"If scanning the QR code doesn't work, you can manually make the payment:"}),(0,n.jsxs)("ul",{className:"text-sm text-gray-600 list-disc pl-5 space-y-1",children:[(0,n.jsxs)("li",{children:["Open your UPI app (",d.app_name,")"]}),(0,n.jsx)("li",{children:'Select "Pay to UPI ID" or "Pay to VPA"'}),(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:"font-medium",children:"UPI ID:"})," ",d.upi_id]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Amount:"})," ₹",i]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Reference ID:"})," ",h," (important for tracking)"]})]})]})]})}}},function(e){e.O(0,[420,878,88,971,117,744],function(){return e(e.s=3355)}),_N_E=e.O()}]);